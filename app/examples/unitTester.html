<div id="examples">
    <h3 class="text-blue">iceUnit</h3>

    <p>Helper object to reduce boilerplate code when unit testing angular controllers, services, directives, etc.</p>


    <h4>Available since</h4>

    <p>0.2.0</p>

    <h4>Usage</h4>

    <li><u>testing a <strong>controller</strong></u></li>

    <p>p.s. Example when the 'building' of the controller under test ('YourCtrl') is <u>not</u> done in a beforeEach block, so that you can setup some mocking before the controller is initialised.</p>

    <pre>
        <code>
            <span class="other">'use strict';</span>
            <span class="other"></span>
            <span class="other">describe('YourCtrl:', function() {</span>
            <span class="indent ice">var $scope;</span>
            <span class="indent other"></span>
            <span class="indent special">var buildController = function() {</span>
            <span class="indent2 ice">$scope = iceUnit</span>
            <span class="indent4 ice">.controllerScopeBuilder(</span><span class="special">'YourApp', 'YourCtrl'</span><span class="ice">)</span>
            <span class="indent4 optional">[.withMock(&lt;injectKey&gt;, &lt;mock&gt;)]</span>
            <span class="indent4 optional">[.withParentScope({...})]</span>
            <span class="indent4 optional">[.skipModuleLoad()]</span><span class="indent special">// if you loaded the module already (e.g. to setup mocking)</span>
            <span class="indent4 ice">.build();</span>
            <span class="indent special">};</span>
            <span class="indent other"></span>
            <span class="indent other">it('some scope test', function() {</span>
            <span class="indent2 special">buildController();</span>
            <span class="indent2 other"></span>
            <span class="indent2 other">expect($scope...).toBe(...);</span>
            <span class="indent other">});</span>
            <span class="other">});</span>
        </code>
    </pre>

    <li><u>testing a <strong>service</strong></u></li>

    <p>p.s. Example when replacing a dependency (in this case the $log service) of the service under test ('yourService') with a mock/stub of your own.</p>

    <pre>
        <code>
            <span class="other">'use strict';</span>
            <span class="other"></span>
            <span class="other">describe('yourService:', function() {</span>
            <span class="indent ice">var yourService;</span>
            <span class="indent other"></span>
            <span class="indent special">var logMock = {</span>
            <span class="indent2 special">info: function() {},</span>
            <span class="indent2 special">error: function() {}</span>
            <span class="indent special">};</span>
            <span class="indent other"></span>
            <span class="indent special">beforeEach(function() {</span>
            <span class="indent2 ice">yourService = iceUnit</span>
            <span class="indent4 ice">.serviceBuilder(</span><span class="special">'ServiceModule', 'yourService'</span><span class="ice">)</span>
            <span class="indent4 optional">[.withMock('$log', logMock)]</span>
            <span class="indent4 ice">.build();</span>
            <span class="indent special">});</span>
            <span class="indent other"></span>
            <span class="indent other">it('test where the $log service is replaced with my own logMock object', function() {</span>
            <span class="indent2 ice">yourService.</span><span class="other">callSomeMethod(...);</span>
            <span class="indent2 other"></span>
            <span class="indent2 other">expect(...).toBe(...);</span>
            <span class="indent other">});</span>
            <span class="other">});</span>
        </code>
    </pre>

    <li><u>testing a <strong>directive</strong></u></li>

    <pre>
        <code>
            <span class="other">'use strict';</span>
            <span class="other"></span>
            <span class="other">describe('yourDirective:', function() {</span>
            <span class="indent ice">var $scope;</span>
            <span class="indent ice">var element;</span>
            <span class="indent other"></span>
            <span class="indent special">beforeEach(function () {</span>
            <span class="indent2 ice">var directiveTester = iceUnit</span>
            <span class="indent4 ice">.directiveBuilder(</span><span class="special">'YourApp', 'HTML of element'</span><span class="ice">)</span>
            <span class="indent4 optional">[.withScopeField('someFieldName', 'some initial value')]</span>
            <span class="indent4 ice">.build();</span>
            <span class="indent2 ice"></span>
            <span class="indent2 ice">$scope = directiveTester.$scope;</span>
            <span class="indent2 ice">element = directiveTester.element;</span>
            <span class="indent special">});</span>
            <span class="indent other"></span>
            <span class="indent other">it('some directive test', function() {</span>
            <span class="indent2 special">element. ...</span>
            <span class="indent other">});</span>
            <span class="other">});</span>
        </code>
    </pre>

    <li><u>just injecting a <strong>service</strong></u></li>

    <p>you can do</p>

    <pre>
        <code>
            <span class="ice">var $httpBackend;</span>
            <span class="other"></span>
            <span class="special">beforeEach(function() {</span>
            <span class="indent ice">$httpBackend = iceUnit.inject('$httpBackend');</span>
            <span class="special">});</span>
        </code>
    </pre>

    <p>instead of</p>

    <pre>
        <code>
            <span class="ice">var $httpBackend;</span>
            <span class="other"></span>
            <span class="special">beforeEach(inject(function(_$httpBackend_) {</span>
            <span class="indent ice">$httpBackend = _$httpBackend_;</span>
            <span class="special">}));</span>
        </code>
    </pre>

    <li><u>mocking a <strong>promise</strong></u></li>

    <p>Need to test code that behaves differently based on a promise? With the 'get[...]PromiseMock' functions you can mock a promise and simulate its success- or error callback.<br/>
    </p>

    <p><strong>getPromiseMock(</strong>callbackObject<strong>)</strong> supports following promise methods:</p>

    <pre>
        <code>
            <span class="special">.then(successCallback, errorCallback, notifyCallback)</span>
            <span class="other"></span>
            <span class="special">.catch(errorCallback)</span>
        </code>
    </pre>

    <p><strong>getHttpPromiseMock(</strong>callbackObject<strong>)</strong> - specifically made to mock an angular $http call - supports following promise methods:</p>

    <pre>
        <code>
            <span class="special">.then(successCallback, errorCallback, notifyCallback)</span>
            <span class="other"></span>
            <span class="special">.catch(errorCallback)</span>
            <span class="other"></span>
            <span class="special">.success(successCallback)</span>
            <span class="indent special">.error(errorCallback)</span>
        </code>
    </pre>

    <p>the callback functions are stored in the input <strong>callbackObject</strong>:</p>

    <pre>
        <code>
            <span class="special">callbackObject</span><span class="ice">.success</span>
            <span class="special">callbackObject</span><span class="ice">.error</span>
            <span class="special">callbackObject</span><span class="ice">.notify</span>
        </code>
    </pre>

    <p><strong>Example</strong> where 'myService.myMethod()' behaves differently based on the promise returned by the 'getSomething' method of 'anotherService'.</p>

    <pre>
        <code>
            <span class="other">'use strict';</span>
            <span class="other"></span>
            <span class="other">describe('myService:', function() {</span>
            <span class="indent special">var myService;</span>
            <span class="indent ice">var getSomethingCallBacker = {};</span><span class="indent special">// success and error callbacks will be stored in this object</span>
            <span class="indent other"></span>
            <span class="indent special">var anotherServiceMock = {</span>
            <span class="indent2 special">getSomething: </span><span class="ice">iceUnit.getHttpPromiseMock(getSomethingCallBacker)</span>
            <span class="indent special">};</span>
            <span class="indent other"></span>
            <span class="indent other">beforeEach(function() {</span>
            <span class="indent2 special">myService = iceUnit</span>
            <span class="indent4 special">.serviceBuilder(</span><span class="special">'ServiceModule', 'myService'</span><span class="special">)</span>
            <span class="indent4 ice">.withMock('anotherService', anotherServiceMock)</span><span class="indent special">// replace the service dependency with the promise mock</span>
            <span class="indent4 special">.build();</span>
            <span class="indent other">});</span>
            <span class="indent other"></span>
            <span class="indent other">it('test when anotherService.getSomething() runs successfully', function() {</span>
            <span class="indent2 special">myService.myMethod();</span>
            <span class="indent2 other"></span>
            <span class="indent2 ice">getSomethingCallBacker.success({something: 'some value'});</span><span class="indent special">// simulate promise success (pass success data)</span>
            <span class="indent2 other"></span>
            <span class="indent2 other">expect(...).toBe(...);</span>
            <span class="indent other">});</span>
            <span class="indent other"></span>
            <span class="indent other">it('test when anotherService.getSomething() fails', function() {</span>
            <span class="indent2 special">myService.myMethod();</span>
            <span class="indent2 other"></span>
            <span class="indent2 ice">getSomethingCallBacker.error('service is down', 404);</span><span class="indent special">// simulate promise error</span>
            <span class="indent2 other"></span>
            <span class="indent2 other">expect(...).toBe(...);</span>
            <span class="indent other">});</span>
            <span class="other">});</span>
        </code>
    </pre>

    <h4>Live example(s)</h4>

    <p>See some <strong>_test.js</strong> files in the <a href="https://github.com/bverbist/angular-ice" target="_blank">angular-ice github code</a></p>

</div>
